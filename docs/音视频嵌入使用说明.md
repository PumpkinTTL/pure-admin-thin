# 文章编辑器 - 音视频嵌入使用说明

## 📝 功能说明

已为 `md-editor-v3` 编辑器配置自定义 sanitize 规则，现在支持在文章中嵌入音视频内容。

---

## ✅ 支持的标签

### 1. iframe 嵌入（推荐用于第三方平台视频）
- B站视频
- YouTube 视频
- 优酷、腾讯视频等

### 2. HTML5 原生标签
- `<video>` - 视频播放
- `<audio>` - 音频播放
- `<source>` - 媒体源
- `<track>` - 字幕轨道

---

## 🎬 使用示例

### 方式一：嵌入 B站视频（iframe）

在 Markdown 编辑器中直接写入以下 HTML 代码：

```html
<iframe 
  src="//player.bilibili.com/player.html?aid=XXXXXXX&bvid=BVXXXXXXXXX&cid=XXXXXXX&page=1" 
  width="100%" 
  height="500" 
  frameborder="0" 
  allowfullscreen="true">
</iframe>
```

**如何获取 B站视频的嵌入代码：**
1. 打开 B站视频页面
2. 点击视频下方的"分享"按钮
3. 选择"嵌入代码"
4. 复制代码粘贴到编辑器即可

---

### 方式二：嵌入 YouTube 视频（iframe）

```html
<iframe 
  width="560" 
  height="315" 
  src="https://www.youtube.com/embed/VIDEO_ID" 
  frameborder="0" 
  allowfullscreen>
</iframe>
```

---

### 方式三：HTML5 视频播放器（本地视频）

适用于上传到自己服务器的视频文件：

```html
<video controls width="100%">
  <source src="https://your-domain.com/videos/sample.mp4" type="video/mp4">
  <source src="https://your-domain.com/videos/sample.webm" type="video/webm">
  您的浏览器不支持 video 标签。
</video>
```

**可选属性：**
- `controls` - 显示播放控制条
- `autoplay` - 自动播放（不推荐）
- `loop` - 循环播放
- `muted` - 静音
- `poster` - 视频封面图
- `preload` - 预加载策略（auto/metadata/none）

---

### 方式四：HTML5 音频播放器（本地音频）

```html
<audio controls>
  <source src="https://your-domain.com/audios/sample.mp3" type="audio/mpeg">
  <source src="https://your-domain.com/audios/sample.ogg" type="audio/ogg">
  您的浏览器不支持 audio 标签。
</audio>
```

---

### 方式五：带字幕的视频

```html
<video controls width="100%">
  <source src="https://your-domain.com/videos/sample.mp4" type="video/mp4">
  <track 
    kind="subtitles" 
    src="https://your-domain.com/subtitles/chinese.vtt" 
    srclang="zh" 
    label="中文字幕">
  <track 
    kind="subtitles" 
    src="https://your-domain.com/subtitles/english.vtt" 
    srclang="en" 
    label="English">
</video>
```

---

## 🎨 样式优化建议

### 响应式视频容器

为了让视频在不同设备上自适应，可以这样写：

```html
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe 
    src="//player.bilibili.com/player.html?aid=XXXXXXX" 
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
    frameborder="0" 
    allowfullscreen>
  </iframe>
</div>
```

> 56.25% = 9/16，这是 16:9 比例的视频容器

---

## 🔒 安全说明

### 白名单机制
编辑器已配置自定义 sanitize 规则，使用白名单方式过滤 HTML 标签：

✅ **允许的标签：**
- 多媒体：`iframe`, `video`, `audio`, `source`, `track`
- 文本：`p`, `div`, `span`, `a`, `img`, `h1`-`h6` 等
- 表格：`table`, `tr`, `td` 等

❌ **禁止的标签：**
- `<script>` - 脚本标签
- `<style>` - 样式标签（但允许 style 属性）
- 其他潜在危险标签

### URL 协议限制
只允许安全的 URL 协议：
- ✅ `http://`, `https://`
- ✅ `mailto:`, `tel:`
- ❌ `javascript:` （会被过滤）

---

## 📊 支持的格式

### 视频格式
- **MP4** (推荐) - 兼容性最好
- **WebM** - 现代浏览器支持
- **Ogg** - 部分浏览器支持

### 音频格式
- **MP3** (推荐) - 兼容性最好
- **AAC** - 高质量音频
- **WAV** - 无损音频
- **Ogg Vorbis** - 开源格式

---

## ⚠️ 注意事项

1. **文件大小**
   - 视频文件通常较大，建议使用第三方平台（B站、YouTube）托管
   - 如需自己托管，建议使用 CDN 加速

2. **浏览器兼容性**
   - HTML5 video/audio 标签在现代浏览器中都支持
   - 提供多种格式的 source 可以提高兼容性

3. **移动端优化**
   - 在移动设备上自动播放可能被阻止
   - 建议设置合适的 width 和 height，或使用百分比

4. **服务器配置**
   - 确保服务器支持音视频文件的 MIME 类型
   - 考虑启用 Range Requests 支持拖动进度条

---

## 🧪 测试示例

在文章编辑器中粘贴以下代码测试：

```html
<!-- B站视频示例 -->
<iframe 
  src="//player.bilibili.com/player.html?bvid=BV1GJ411x7h7" 
  width="100%" 
  height="500" 
  frameborder="0" 
  allowfullscreen>
</iframe>

<!-- HTML5 视频示例 -->
<video controls width="100%" poster="https://example.com/poster.jpg">
  <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
  您的浏览器不支持 video 标签。
</video>

<!-- HTML5 音频示例 -->
<audio controls>
  <source src="https://www.w3schools.com/html/horse.mp3" type="audio/mpeg">
  您的浏览器不支持 audio 标签。
</audio>
```

---

## 🚀 后续扩展建议

如果需要更友好的用户体验，可以考虑：

1. **添加工具栏按钮**
   - 点击按钮弹出对话框
   - 输入视频URL自动生成嵌入代码

2. **集成专业播放器**
   - video.js
   - xgplayer（西瓜播放器）
   - DPlayer

3. **视频上传功能**
   - 实现大文件分片上传
   - 视频格式转码
   - 生成多分辨率版本

4. **云存储集成**
   - 阿里云 OSS
   - 腾讯云 COS
   - 七牛云存储

---

## 📚 相关文档

- [MDN - HTML video 元素](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video)
- [MDN - HTML audio 元素](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/audio)
- [md-editor-v3 官方文档](https://imzbf.github.io/md-editor-v3/)

---

**更新时间：** 2025-10-11  
**版本：** v1.0

