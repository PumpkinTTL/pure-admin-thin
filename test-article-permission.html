<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« æƒé™æµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .result {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 13px;
            line-height: 1.6;
        }

        .success {
            color: #48bb78;
            font-weight: bold;
        }

        .error {
            color: #f56565;
            font-weight: bold;
        }

        .info {
            color: #4299e1;
            font-weight: bold;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .status-logged-in {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-logged-out {
            background: #fed7d7;
            color: #742a2a;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ–‡ç« æƒé™æµ‹è¯•å·¥å…·</h1>

        <!-- Tokené…ç½® -->
        <div class="card">
            <h2>1ï¸âƒ£ Tokené…ç½®</h2>
            <div class="form-group">
                <label>APIåœ°å€:</label>
                <input type="text" id="apiUrl" value="http://localhost/api/v1" placeholder="http://your-api.com/api/v1">
            </div>
            <div class="form-group">
                <label>ç™»å½•Token (Bearer Token):</label>
                <textarea id="token" placeholder="ç²˜è´´ä½ çš„JWT Token..."></textarea>
            </div>
            <div class="form-group">
                <label>å½“å‰çŠ¶æ€: <span id="loginStatus" class="status-badge status-logged-out">æœªç™»å½•</span></label>
            </div>
        </div>

        <!-- å¿«æ·ç™»å½• -->
        <div class="card">
            <h2>2ï¸âƒ£ å¿«æ·ç™»å½•</h2>
            <div class="grid">
                <div class="form-group">
                    <label>ç”¨æˆ·å:</label>
                    <input type="text" id="username" value="admin" placeholder="ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label>å¯†ç :</label>
                    <input type="text" id="password" value="admin123" placeholder="å¯†ç ">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-success" onclick="login()">ğŸ”‘ ç™»å½•</button>
                <button class="btn btn-danger" onclick="clearToken()">ğŸšª ç™»å‡º</button>
            </div>
            <div id="loginResult" class="result" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•æ–‡ç« åˆ—è¡¨ -->
        <div class="card">
            <h2>3ï¸âƒ£ æµ‹è¯•æ–‡ç« åˆ—è¡¨æŸ¥è¯¢</h2>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="testArticleList(true)">ğŸ“ å¸¦TokenæŸ¥è¯¢</button>
                <button class="btn btn-primary" onclick="testArticleList(false)">ğŸŒ ä¸å¸¦TokenæŸ¥è¯¢</button>
            </div>
            <div id="articleResult" class="result" style="display:none;"></div>
        </div>

        <!-- å•ç¯‡æ–‡ç« æµ‹è¯• -->
        <div class="card">
            <h2>4ï¸âƒ£ æµ‹è¯•å•ç¯‡æ–‡ç« è¯¦æƒ…</h2>
            <div class="form-group">
                <label>æ–‡ç« ID:</label>
                <input type="text" id="articleId" value="99999" placeholder="è¾“å…¥æ–‡ç« ID">
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="testArticleDetail(true)">ğŸ“– å¸¦TokenæŸ¥è¯¢</button>
                <button class="btn btn-primary" onclick="testArticleDetail(false)">ğŸŒ ä¸å¸¦TokenæŸ¥è¯¢</button>
            </div>
            <div id="detailResult" class="result" style="display:none;"></div>
        </div>

        <!-- SQLæµ‹è¯• -->
        <div class="card">
            <h2>5ï¸âƒ£ æ•°æ®åº“æŸ¥è¯¢éªŒè¯</h2>
            <p style="color: #718096; margin-bottom: 15px;">
                ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä»¥ä¸‹SQLæ¥éªŒè¯æ–‡ç« å¯è§æ€§è®¾ç½®ï¼š
            </p>
            <textarea readonly style="background: #f7fafc; font-family: 'Courier New', monospace;">
-- æŸ¥çœ‹æ‰€æœ‰æ–‡ç« çš„å¯è§æ€§è®¾ç½®
SELECT id, title, author_id, visibility, status FROM bl_article ORDER BY id DESC LIMIT 20;

-- æŸ¥çœ‹ç™»å½•å¯è§çš„æ–‡ç« 
SELECT id, title, visibility FROM bl_article WHERE visibility = 'login_required';

-- æŸ¥çœ‹æŒ‡å®šç”¨æˆ·æƒé™
SELECT * FROM bl_article_user_access WHERE article_id = 99999;

-- æŸ¥çœ‹æŒ‡å®šè§’è‰²æƒé™
SELECT * FROM bl_article_role_access WHERE article_id = 99999;
            </textarea>
        </div>
    </div>

    <script>
        // æ›´æ–°ç™»å½•çŠ¶æ€æ˜¾ç¤º
        function updateLoginStatus() {
            const token = document.getElementById('token').value.trim();
            const statusEl = document.getElementById('loginStatus');
            
            if (token) {
                statusEl.className = 'status-badge status-logged-in';
                statusEl.textContent = 'å·²ç™»å½•';
            } else {
                statusEl.className = 'status-badge status-logged-out';
                statusEl.textContent = 'æœªç™»å½•';
            }
        }

        // ç›‘å¬Tokenè¾“å…¥å˜åŒ–
        document.getElementById('token').addEventListener('input', updateLoginStatus);

        // ç™»å½•
        async function login() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const resultEl = document.getElementById('loginResult');

            if (!username || !password) {
                showResult(resultEl, 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }

            try {
                resultEl.style.display = 'block';
                resultEl.innerHTML = '<pre><span class="info">æ­£åœ¨ç™»å½•...</span></pre>';

                const response = await fetch(`${apiUrl}/user/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (data.code === 200 && data.token) {
                    document.getElementById('token').value = data.token;
                    updateLoginStatus();
                    showResult(resultEl, 'ç™»å½•æˆåŠŸï¼\n\nå®Œæ•´å“åº”:\n' + JSON.stringify(data, null, 2), 'success');
                } else {
                    showResult(resultEl, 'ç™»å½•å¤±è´¥: ' + (data.msg || 'æœªçŸ¥é”™è¯¯') + '\n\n' + JSON.stringify(data, null, 2), 'error');
                }
            } catch (error) {
                showResult(resultEl, 'è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ¸…é™¤Token
        function clearToken() {
            document.getElementById('token').value = '';
            updateLoginStatus();
            alert('Tokenå·²æ¸…é™¤ï¼Œç°åœ¨å¤„äºæœªç™»å½•çŠ¶æ€');
        }

        // æµ‹è¯•æ–‡ç« åˆ—è¡¨
        async function testArticleList(withToken) {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const token = document.getElementById('token').value.trim();
            const resultEl = document.getElementById('articleResult');

            resultEl.style.display = 'block';
            resultEl.innerHTML = '<pre><span class="info">æ­£åœ¨æŸ¥è¯¢æ–‡ç« åˆ—è¡¨...</span></pre>';

            try {
                const headers = {
                    'Content-Type': 'application/json'
                };

                if (withToken && token) {
                    headers['Authorization'] = 'Bearer ' + token;
                }

                const response = await fetch(`${apiUrl}/article/selectArticleAll?page=1&page_size=20`, {
                    method: 'GET',
                    headers: headers
                });

                const data = await response.json();
                
                let resultText = `=== ${withToken ? 'å·²ç™»å½•' : 'æœªç™»å½•'}ç”¨æˆ·æŸ¥è¯¢ç»“æœ ===\n\n`;
                resultText += `å“åº”ç : ${data.code}\n`;
                resultText += `æ¶ˆæ¯: ${data.msg}\n`;
                
                if (data.data && data.data.list) {
                    resultText += `æ–‡ç« æ€»æ•°: ${data.data.pagination.total}\n`;
                    resultText += `å½“å‰é¡µ: ${data.data.pagination.current}\n`;
                    resultText += `è¿”å›æ•°é‡: ${data.data.list.length}\n\n`;
                    
                    resultText += 'æ–‡ç« åˆ—è¡¨:\n';
                    data.data.list.forEach((article, index) => {
                        resultText += `${index + 1}. [${article.id}] ${article.title}\n`;
                        resultText += `   å¯è§æ€§: ${article.visibility || 'æœªè®¾ç½®'}\n`;
                        resultText += `   çŠ¶æ€: ${article.status === 1 ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}\n`;
                        resultText += `   ä½œè€…ID: ${article.author_id}\n\n`;
                    });
                }
                
                resultText += '\nå®Œæ•´å“åº”:\n' + JSON.stringify(data, null, 2);
                
                showResult(resultEl, resultText, data.code === 200 ? 'success' : 'error');
            } catch (error) {
                showResult(resultEl, 'è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æµ‹è¯•æ–‡ç« è¯¦æƒ…
        async function testArticleDetail(withToken) {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const token = document.getElementById('token').value.trim();
            const articleId = document.getElementById('articleId').value.trim();
            const resultEl = document.getElementById('detailResult');

            if (!articleId) {
                showResult(resultEl, 'è¯·è¾“å…¥æ–‡ç« ID', 'error');
                return;
            }

            resultEl.style.display = 'block';
            resultEl.innerHTML = '<pre><span class="info">æ­£åœ¨æŸ¥è¯¢æ–‡ç« è¯¦æƒ…...</span></pre>';

            try {
                const headers = {
                    'Content-Type': 'application/json'
                };

                if (withToken && token) {
                    headers['Authorization'] = 'Bearer ' + token;
                }

                const response = await fetch(`${apiUrl}/article/selectArticleById?id=${articleId}`, {
                    method: 'GET',
                    headers: headers
                });

                const data = await response.json();
                
                let resultText = `=== ${withToken ? 'å·²ç™»å½•' : 'æœªç™»å½•'}ç”¨æˆ·æŸ¥è¯¢ç»“æœ ===\n\n`;
                resultText += `å“åº”ç : ${data.code}\n`;
                resultText += `æ¶ˆæ¯: ${data.msg}\n\n`;
                
                if (data.data) {
                    resultText += `æ–‡ç« ID: ${data.data.id}\n`;
                    resultText += `æ ‡é¢˜: ${data.data.title}\n`;
                    resultText += `å¯è§æ€§: ${data.data.visibility || 'æœªè®¾ç½®'}\n`;
                    resultText += `ä½œè€…ID: ${data.data.author_id}\n`;
                    resultText += `çŠ¶æ€: ${data.data.status}\n\n`;
                }
                
                resultText += 'å®Œæ•´å“åº”:\n' + JSON.stringify(data, null, 2);
                
                showResult(resultEl, resultText, data.code === 200 ? 'success' : 'error');
            } catch (error) {
                showResult(resultEl, 'è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(element, text, type) {
            const className = type === 'success' ? 'success' : (type === 'error' ? 'error' : 'info');
            element.style.display = 'block';
            element.innerHTML = `<pre><span class="${className}">${text}</span></pre>`;
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°çŠ¶æ€
        updateLoginStatus();
    </script>
</body>
</html>

